<script type="text/babel">
    // =====================================
    // IMPORTANT: PLACE YOUR ACTUAL FIREBASE CONFIGURATION HERE
    // You MUST replace the placeholder values with your project's
    // firebaseConfig object that you copied from the Firebase Console.
    // This is necessary because the __firebase_config global variable
    // is only available in the Canvas environment, not on your live website.
    // =====================================
    const YOUR_FIREBASE_CONFIG = {
      apiKey: "AIzaSyCBArZDX7_q4YtI48BQvkOt95xhvu2UJ40",
      authDomain: "https://realbugti.github.io/study",
      projectId: "study-1e97d",
      storageBucket: "YOUR_STORAGE_BUCKET_HERE",
      messagingSenderId: "515835913903",
      appId: "1:515835913903:web:7f337d04e948b65f5b565a",
      // measurementId: "G-S8C6QB76EV" // Include if you have it and want analytics
    };

    // Main App component
    const App = () => {
      // Firebase variables will be initialized here
      const [db, setDb] = React.useState(null);
      const [auth, setAuth] = React.useState(null);
      const [userId, setUserId] = React.useState('Loading User...');
      const [isAuthReady, setIsAuthReady] = React.useState(false); // To track Firebase auth status
      const [userEmail, setUserEmail] = React.useState(null); // To store authenticated user's email

      // Game state variables (rest of your game state is here)
      const [studentName, setStudentName] = React.useState('');
      const [gameStarted, setGameStarted] = React.useState(false);
      const [category, setCategory] = React.useState(null);
      const [difficulty, setDifficulty] = React.useState(null);
      const [score, setScore] = React.useState(0);
      const [wrongAnswers, setWrongAnswers] = React.useState(0);
      const [currentQuestionIndex, setCurrentQuestionIndex] = React.useState(0);
      const [feedbackMessage, setFeedbackMessage] = React.useState('');
      const [gameOver, setGameOver] = React.useState(false);
      const [selectedOption, setSelectedOption] = React.useState(null);
      const [showAnswer, setShowAnswer] = React.useState(false);
      const [questions, setQuestions] = React.useState([]); // The 10 questions for the current game session

      // History state variables
      const [showHistory, setShowHistory] = React.useState(false);
      const [gameHistory, setGameHistory] = React.useState([]);

      // New state for Study Mode, Scholarships, and English Learning
      const [showStudyMode, setShowStudyMode] = React.useState(false);
      const [showScholarshipsMode, setShowScholarshipsMode] = React.useState(false);
      const [showEnglishLearningMode, setShowEnglishLearningMode] = React.useState(false);

      // Authentication form states
      const [showAuthForm, setShowAuthForm] = React.useState(false);
      const [isRegisterMode, setIsRegisterMode] = React.useState(true); // true for register, false for login
      const [email, setEmail] = React.useState('');
      const [password, setPassword] = React.useState('');
      const [authError, setAuthError] = React.useState('');


      // Function to get public IP address
      const getPublicIpAddress = async () => {
          try {
              const response = await fetch('https://api.ipify.org?format=json');
              if (!response.ok) {
                  throw new Error(`HTTP error! status: ${response.status}`);
              }
              const data = await response.json();
              return data.ip || 'Unknown';
          } catch (error) {
              console.error("Could not fetch public IP address:", error);
              return 'Failed to retrieve IP';
          }
      };

      // Firebase Initialization and Authentication
      React.useEffect(() => {
        console.log("Attempting Firebase initialization...");
        // Use the hardcoded Firebase config for deployment on GitHub Pages
        const firebaseConfig = YOUR_FIREBASE_CONFIG;
        const appId = YOUR_FIREBASE_CONFIG.appId; // Use appId from your config

        // Basic check if config is actually filled out
        if (!firebaseConfig.projectId || firebaseConfig.apiKey.includes('YOUR_API_KEY')) {
            console.error("Firebase config is not set up correctly. Please replace placeholders in YOUR_FIREBASE_CONFIG.");
            setFeedbackMessage("Firebase not configured. History saving disabled.");
            setUserId(`ConfigMissing_${crypto.randomUUID().substring(0, 8)}`);
            setIsAuthReady(true);
            return; // Abort further Firebase initialization
        }

        if (window.firebase) {
            console.log("Firebase App ID:", appId);
            console.log("Firebase Config loaded (showing project ID):", firebaseConfig.projectId);

            try {
                const app = window.firebase.initializeApp(firebaseConfig);
                const authInstance = window.firebase.getAuth(app);
                const dbInstance = window.firebase.getFirestore(app);

                setAuth(authInstance);
                setDb(dbInstance);

                const unsubscribe = window.firebase.onAuthStateChanged(authInstance, async (user) => {
                    console.log("Auth state changed. User:", user);
                    if (user) {
                        setUserId(user.uid);
                        setUserEmail(user.email);
                        setIsAuthReady(true);
                    } else {
                        // On a live website, you don't have __initial_auth_token.
                        // Sign in anonymously if no user is found, as a fallback.
                        console.log("No authenticated user, attempting anonymous sign-in...");
                        try {
                            await window.firebase.signInAnonymously(authInstance);
                        } catch (anonError) {
                            console.error("Firebase Anonymous Auth Error:", anonError);
                            setUserId(`AuthFailed_${crypto.randomUUID().substring(0, 8)}`);
                            setIsAuthReady(true);
                        }
                    }
                });
                return () => unsubscribe();
            } catch (error) {
                console.error("Firebase Runtime Initialization Error:", error);
                setFeedbackMessage("Failed to initialize Firebase runtime. History won't be saved.");
                setUserId(`RuntimeError_${crypto.randomUUID().substring(0, 8)}`);
                setIsAuthReady(true);
            }
        } else {
            console.warn("Firebase SDK not loaded. History saving disabled.");
            setFeedbackMessage("Firebase SDK not loaded. History won't be saved.");
            setUserId(`SDKLoadError_${crypto.randomUUID().substring(0, 8)}`);
            setIsAuthReady(true);
        }
      }, []); // Run only once on component mount

      // ... (the rest of your App component code, including all other useEffects and functions)
      // ... (scroll down and ensure the entire component is included)

      // Get motivational message based on performance
      const getMotivationalMessage = () => {
        const totalQuestions = questions.length; 
        const percentage = totalQuestions > 0 ? (score / totalQuestions) * 100 : 0;

        let message = `You scored ${score} out of ${totalQuestions} questions.`;

        if (score === totalQuestions && wrongAnswers === 0) {
          message += ` Phenomenal, ${studentName || userEmail}! You're truly mastering this field! Keep aiming higher!`;
        } else if (percentage >= 80) {
          message += ` Excellent work, ${studentName || userEmail}! Your dedication shines through. Keep pushing for perfection!`;
        } else if (percentage >= 50) {
          message += ` Good effort, ${studentName || userEmail}! You're on the right track. Every question is a stepping stone. A little more focus, and you'll be unstoppable!`;
        } else {
          message += ` This is a learning journey, ${studentName || userEmail}. Every challenge is an opportunity to grow. Remember, consistent effort transforms potential into mastery. This isn't wasting money; it's an investment in your future! You need to study more and reinforce your foundations. Success is built on persistent effort. Let's aim higher next time!`;
        }
        return message;
      };

      // Render the main game UI
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-900 to-indigo-900 flex items-center justify-center p-4 font-inter text-gray-100">
          <div className="bg-gray-800 bg-opacity-90 rounded-2xl shadow-2xl p-4 sm:p-6 md:p-8 max-w-sm sm:max-w-md md:max-w-2xl w-full flex flex-col items-center animate-fade-in">
            <h1 className="text-3xl sm:text-4xl font-extrabold text-white mb-4 sm:mb-6 text-center leading-tight">
              Engineering & Medical Puzzle App
            </h1>

            {/* User Info and Logout */}
            {isAuthReady && userId && (
                <div className="text-xs sm:text-sm text-gray-400 mb-4 text-center">
                    {userEmail ? (
                        <p>Logged in as: <span className="font-mono text-green-300">{userEmail}</span></p>
                    ) : (
                        <p>Guest User ID: <span className="font-mono text-gray-300 break-all">{userId}</span></p>
                    )}
                    <button
                        onClick={handleLogout}
                        className="mt-2 px-3 py-1 bg-red-600 hover:bg-red-700 text-white text-xs rounded-lg transition duration-200"
                    >
                        Logout
                    </button>
                </div>
            )}
            {/* Firebase config error message */}
            {!isAuthReady && feedbackMessage.includes("Firebase") && (
                <div className="text-sm text-red-400 mb-4 text-center">
                    {feedbackMessage}
                </div>
            )}


            {/* Conditional rendering based on game state */}
            {!gameStarted ? (
              // Initial Name Input / Auth Screen
              <div className="w-full text-center p-4">
                  <p className="text-xl sm:text-2xl mb-6">Welcome, build future, Be professional!</p>
                <p className="text-xl sm:text-2xl mb-6">Created by Nadeem Bugti!</p>

                {showAuthForm ? ( 
                    // Register/Login Form
                    <div className="flex flex-col items-center">
                        <h2 className="text-2xl font-bold mb-4">{isRegisterMode ? 'Register' : 'Login'}</h2>
                        <input
                            type="email"
                            placeholder="Email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className="w-full p-3 rounded-lg mb-3 bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
                        />
                        <input
                            type="password"
                            placeholder="Password"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className="w-full p-3 rounded-lg mb-4 bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
                        />
                        <button
                            onClick={isRegisterMode ? handleRegister : handleLogin}
                            disabled={!isAuthReady || !email || !password}
                            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            {isRegisterMode ? 'Register Account' : 'Login'}
                        </button>
                        <button
                            onClick={() => setIsRegisterMode(!isRegisterMode)}
                            className="mt-4 text-blue-400 hover:underline text-sm"
                        >
                            {isRegisterMode ? 'Already have an account? Login' : 'Need an account? Register'}
                        </button>
                        <button
                            onClick={() => setShowAuthForm(false)}
                            className="mt-4 px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg text-sm transition duration-300"
                        >
                            Back
                        </button>
                        {authError && (
                            <p className="mt-4 text-red-400 font-semibold text-sm">{authError}</p>
                        )}
                    </div>
                ) : (
                    // Initial Choice: Guest or Account
                    <div className="flex flex-col items-center w-full">
                        <label htmlFor="studentName" className="block text-lg font-semibold mb-2">
                            Or enter your name to play as Guest:
                        </label>
                        <input
                            id="studentName"
                            type="text"
                            value={studentName}
                            onChange={(e) => setStudentName(e.target.value)}
                            placeholder="Your Name"
                            className="w-full p-3 rounded-lg mb-4 bg-gray-700 text-white border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 placeholder-gray-400"
                            onKeyPress={(e) => {
                                if (e.key === 'Enter') {
                                    handleStartGame();
                                }
                            }}
                        />
                        <button
                            onClick={handleStartGame}
                            className="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg mb-4"
                        >
                            Play as Guest
                        </button>
                        <p className="text-gray-400 mb-4">or</p>
                        <button
                            onClick={() => setShowAuthForm(true)}
                            className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg"
                            disabled={!isAuthReady}
                        >
                            Create Account / Login
                        </button>
                        {feedbackMessage && !feedbackMessage.includes("Firebase") && (
                            <p className="mt-4 text-red-400 font-semibold">{feedbackMessage}</p>
                        )}
                    </div>
                )}
              </div>
            ) : showHistory ? (
              // Study History Screen (Dashboard)
              <div className="w-full p-4 animate-fade-in-up">
                <h2 className="text-2xl sm:text-3xl font-bold text-white mb-6 text-center">Your Study History</h2>
                {gameHistory.length === 0 ? (
                  <p className="text-base sm:text-lg text-gray-400 text-center">No game records found. Start playing to see your history!</p>
                ) : (
                  <div className="overflow-x-auto rounded-lg shadow-md">
                    <table className="min-w-full bg-gray-700">
                      <thead>
                        <tr className="bg-gray-600 text-left text-gray-200 uppercase text-xs sm:text-sm leading-normal">
                          <th className="py-2 px-3 sm:py-3 sm:px-4 rounded-tl-lg">Date</th>
                          <th className="py-2 px-3 sm:py-3 sm:px-4">Field</th>
                          <th className="py-2 px-3 sm:py-3 sm:px-4">Difficulty</th>
                          <th className="py-2 px-3 sm:py-3 sm:px-4">Score</th>
                          <th className="py-2 px-3 sm:py-3 sm:px-4">Wrong</th>
                          <th className="py-2 px-3 sm:py-3 sm:px-4 rounded-tr-lg">IP Address</th>
                        </tr>
                      </thead>
                      <tbody className="text-gray-300 text-xs sm:text-sm font-light">
                        {gameHistory.map((record) => (
                          <tr key={record.id} className="border-b border-gray-600 hover:bg-gray-700">
                            <td className="py-2 px-3 sm:py-3 sm:px-4 whitespace-nowrap">
                              {record.timestamp ? new Date(record.timestamp.toDate()).toLocaleString() : 'N/A'}
                            </td>
                            <td className="py-2 px-3 sm:py-3 sm:px-4">{record.category}</td>
                            <td className="py-2 px-3 sm:py-3 sm:px-4 capitalize">{record.difficulty}</td>
                            <td className="py-2 px-3 sm:py-3 sm:px-4">{record.score}/{record.totalQuestions}</td>
                            <td className="py-2 px-3 sm:py-3 sm:px-4">{record.wrongAnswers}</td>
                            <td className="py-2 px-3 sm:py-3 sm:px-4">{record.ipAddress || 'N/A'}</td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
                <div className="flex flex-wrap justify-center gap-4 mt-8">
                    <button
                      onClick={() => setShowHistory(false)}
                      className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg text-sm sm:text-base"
                    >
                      Back to Game Menu
                    </button>
                    <button
                        onClick={restartFullGame}
                        className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                        Start Over
                    </button>
                </div>
              </div>
            ) : showStudyMode ? (
              // Study Mode Screen
              <div className="w-full p-4 animate-fade-in-up">
                <h2 className="text-2xl sm:text-3xl font-bold text-white mb-6 text-center">Study Mode: {category}</h2>
                <div className="bg-gray-700 rounded-xl p-4 sm:p-6 mb-6 shadow-inner border border-gray-600">
                    <h3 className="text-lg sm:text-xl font-bold text-yellow-300 mb-4">Expert Advice:</h3>
                    <p className="text-gray-200 text-sm sm:text-lg mb-6 leading-relaxed">
                        {expertAdviceData[category] || "No expert advice available for this category yet."}
                    </p>
                </div>

                <h3 className="text-lg sm:text-xl font-bold text-white mb-4">Question & Answer Bank:</h3>
                <div className="max-h-80 sm:max-h-96 overflow-y-auto pr-2 mb-6">
                    {studyQuestionsData[category] && studyQuestionsData[category].length > 0 ? (
                        studyQuestionsData[category].map((qa, index) => (
                            <div key={index} className="bg-gray-600 rounded-lg p-3 sm:p-4 mb-4 shadow-md">
                                <p className="text-yellow-200 font-semibold mb-2 text-sm sm:text-base">Q: {qa.question}</p>
                                <p className="text-gray-100 text-xs sm:text-sm">{qa.answer}</p>
                            </div>
                        ))
                    ) : (
                        <p className="text-base sm:text-lg text-gray-400 text-center">No study questions available for this category yet.</p>
                    )}
                </div>

                <h3 className="text-lg sm:text-xl font-bold text-white mb-4">Inspiring Success Stories:</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 max-h-80 sm:max-h-96 overflow-y-auto pr-2 mb-6">
                    {successStoriesData[category] && successStoriesData[category].length > 0 ? (
                        successStoriesData[category].map((person, index) => (
                            <div key={index} className="bg-gray-600 rounded-lg p-3 sm:p-4 shadow-md flex flex-col items-center text-center">
                                <img
                                    src={person.imageUrl}
                                    alt={person.name}
                                    className="w-24 h-24 sm:w-32 sm:h-32 rounded-full object-cover border-2 border-yellow-400 mb-3 sm:mb-4"
                                    onError={(e) => { e.target.onerror = null; e.target.src="https://placehold.co/150x150/555555/EEEEEE?text=No+Image"; }}
                                />
                                <p className="text-yellow-200 font-semibold text-lg sm:text-xl mb-1">{person.name}</p>
                                <p className="text-gray-300 text-xs sm:text-sm mb-2">{person.title}</p>
                                <p className="text-gray-100 text-xs sm:text-base mb-4 leading-relaxed">{person.story}</p>
                                {person.motto && (
                                    <p className="text-gray-400 italic text-xs sm:text-sm mb-4">"{person.motto}"</p>
                                )}
                                {person.videoUrl && (
                                    <div className="video-container mt-4 shadow-xl">
                                        <iframe
                                            src={person.videoUrl}
                                            title={`${person.name} success story`}
                                            frameBorder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowFullScreen
                                        ></iframe>
                                    </div>
                                )}
                            </div>
                        ))
                    ) : (
                        <p className="text-base sm:text-lg text-gray-400 text-center col-span-full">No success stories available for this category yet.</p>
                    )}
                </div>

                <div className="flex flex-wrap justify-center gap-4 mt-8">
                    <button
                      onClick={() => setShowStudyMode(false)}
                      className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg text-sm sm:text-base"
                    >
                      Back to Game Menu
                    </button>
                    <button
                        onClick={restartFullGame}
                        className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                        Start Over
                    </button>
                </div>
              </div>
            ) : showScholarshipsMode ? (
              // Scholarships Information Screen
              <div className="w-full p-4 animate-fade-in-up">
                <h2 className="text-2xl sm:text-3xl font-bold text-white mb-6 text-center">International Scholarship Opportunities</h2>
                <p className="text-base sm:text-lg text-gray-300 mb-6 text-center">Explore these international scholarships to fund your education abroad. Always verify eligibility and application deadlines on the official websites.</p>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 max-h-[70vh] overflow-y-auto pr-2">
                    {scholarshipsData.length > 0 ? (
                        scholarshipsData.map((scholarship, index) => (
                            <div key={index} className="bg-gray-700 rounded-xl p-4 sm:p-6 shadow-md border border-gray-600">
                                <h3 className="text-xl sm:text-2xl font-bold text-green-300 mb-2">{scholarship.name}</h3>
                                <p className="text-gray-200 text-sm sm:text-base mb-4">{scholarship.description}</p>
                                <h4 className="text-base sm:text-lg font-semibold text-yellow-300 mb-2">Eligibility:</h4>
                                <ul className="list-disc list-inside text-gray-200 mb-4 pl-4 text-xs sm:text-sm">
                                    {scholarship.eligibility.map((item, i) => (
                                        <li key={i} className="mb-1">{item}</li>
                                    ))}
                                </ul>
                                {scholarship.link && (
                                    <a
                                        href={scholarship.link}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="inline-block bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 shadow-lg text-sm"
                                    >
                                        Learn More
                                    </a>
                                )}
                            </div>
                        ))
                    ) : (
                        <p className="text-base sm:text-lg text-gray-400 text-center col-span-full">No scholarship information available yet.</p>
                    )}
                </div>

                <div className="flex flex-wrap justify-center gap-4 mt-8">
                    <button
                      onClick={() => setShowScholarshipsMode(false)}
                      className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg text-sm sm:text-base"
                    >
                      Back to Game Menu
                    </button>
                    <button
                        onClick={restartFullGame}
                        className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                        Start Over
                    </button>
                </div>
              </div>
            ) : showEnglishLearningMode ? (
              // English Learning Videos Screen
              <div className="w-full p-4 animate-fade-in-up">
                <h2 className="text-2xl sm:text-3xl font-bold text-white mb-6 text-center">English Learning Videos</h2>
                <p className="text-base sm:text-lg text-gray-300 mb-6 text-center">Improve your English skills with these helpful video resources.</p>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 max-h-[70vh] overflow-y-auto pr-2">
                    {englishLearningVideosData.length > 0 ? (
                        englishLearningVideosData.map((video, index) => (
                            <div key={index} className="bg-gray-700 rounded-xl p-4 sm:p-6 shadow-md border border-gray-600 flex flex-col">
                                <h3 className="text-xl sm:text-2xl font-bold text-pink-300 mb-2">{video.title}</h3>
                                <p className="text-gray-200 text-sm sm:text-base mb-4">{video.description}</p>
                                {video.videoUrl && (
                                    <div className="video-container mt-auto shadow-xl"> {/* mt-auto pushes video to bottom if content above is short */}
                                        <iframe
                                            src={video.videoUrl}
                                            title={video.title}
                                            frameBorder="0"
                                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                            allowFullScreen
                                        ></iframe>
                                    </div>
                                )}
                            </div>
                        ))
                    ) : (
                        <p className="text-base sm:text-lg text-gray-400 text-center col-span-full">No English learning videos available yet.</p>
                    )}
                </div>

                <div className="flex flex-wrap justify-center gap-4 mt-8">
                    <button
                      onClick={() => setShowEnglishLearningMode(false)}
                      className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg text-sm sm:text-base"
                    >
                      Back to Game Menu
                    </button>
                    <button
                        onClick={restartFullGame}
                        className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                        Start Over
                    </button>
                </div>
              </div>
            ) : !category || !difficulty ? (
              // Category and Difficulty Selection Screen
              <div className="w-full text-center p-4">
                <p className="text-xl sm:text-2xl font-semibold mb-6 animate-slide-in-top">
                  Hello <span className="text-yellow-300">{userEmail ? userEmail.split('@')[0] : studentName}</span>! Choose your path:
                </p>

                <h3 className="text-lg sm:text-xl font-medium mb-4 text-left">Select your Field of Study:</h3>
                <div className="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8 animate-fade-in-up">
                  {Object.keys(questionsData).map((cat) => (
                    <button
                      key={cat}
                      onClick={() => handleCategorySelect(cat)}
                      className={`py-3 px-4 sm:py-4 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg text-sm sm:text-base ${
                        category === cat
                          ? 'bg-blue-700 ring-2 ring-blue-400'
                          : 'bg-blue-600 hover:bg-blue-700'
                      } text-white font-bold`}
                    >
                      {cat} {cat === 'Medical' ? '' : 'Engineering'}
                    </button>
                  ))}
                </div>

                {category && (
                  <>
                    <h3 className="text-lg sm:text-xl font-medium mb-4 text-left">Select Difficulty Level:</h3>
                    <div className="grid grid-cols-1 sm:grid-cols-3 gap-4 animate-fade-in-up delay-200">
                      {['easy', 'medium', 'hard'].map((level) => (
                        <button
                          key={level}
                          onClick={() => handleDifficultySelect(level)}
                          className={`py-3 px-4 sm:py-4 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg capitalize text-sm sm:text-base ${
                            difficulty === level
                              ? 'bg-purple-700 ring-2 ring-purple-400'
                              : 'bg-purple-600 hover:bg-purple-700'
                          } text-white font-bold`}
                        >
                          {level}
                        </button>
                      ))}
                    </div>
                  </>
                )}

                <div className="mt-8 flex flex-wrap justify-center gap-3 sm:gap-4">
                    <button
                      onClick={restartFullGame}
                      className="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                      Start Over
                    </button>
                    <button
                        onClick={() => setShowHistory(true)}
                        className="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                        disabled={!isAuthReady || gameHistory.length === 0}
                    >
                        View My Study History ({gameHistory.length})
                    </button>
                    <button
                        onClick={() => setShowScholarshipsMode(true)}
                        className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                        International Scholarships
                    </button>
                    <button
                        onClick={() => setShowEnglishLearningMode(true)}
                        className="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                    >
                        English Learning Videos
                    </button>
                </div>
              </div>
            ) : (
              // Game Play Screen
              <div className="w-full flex flex-col items-center animate-fade-in-up">
                <h2 className="text-xl sm:text-2xl font-semibold mb-4 text-center">
                  Category: {category} {category === 'Medical' ? '' : 'Engineering'} | Difficulty: {difficulty}
                </h2>

                {gameOver ? (
                  // Game Over Screen
                  <div className="text-center p-4">
                    <p className="text-2xl sm:text-3xl font-bold text-red-400 mb-4 animate-bounce-in">Game Over!</p>
                    <p className="text-lg sm:text-xl mb-4">You scored: <span className="font-bold text-green-400">{score}</span> out of {questions.length}</p>
                    <p className="text-base sm:text-lg text-gray-300 mb-6 motion-safe:animate-pulse">{getMotivationalMessage()}</p>
                    <div className="flex flex-wrap justify-center gap-3 sm:gap-4">
                      <button
                        onClick={resetGame}
                        className="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                      >
                        Play Again (Same Settings)
                      </button>
                      <button
                        onClick={() => { setCategory(null); setDifficulty(null); }}
                        className="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                      >
                        Change Category/Difficulty
                      </button>
                      {isAuthReady && userId && (
                        <button
                            onClick={() => setShowStudyMode(true)}
                            className="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                        >
                            Study Now
                        </button>
                      )}
                      <button
                        onClick={() => setShowScholarshipsMode(true)}
                        className="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 sm:py-3 sm:px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                      >
                        International Scholarships
                      </button>
                      <button
                        onClick={() => setShowEnglishLearningMode(true)}
                        className="bg-pink-600 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                      >
                        English Learning Videos
                      </button>
                    </div>
                    <button
                        onClick={restartFullGame}
                        className="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-md text-sm sm:text-base"
                      >
                        Start Over (New Name)
                      </button>
                  </div>
                ) : (
                  // Current Question Display
                  <div className="w-full">
                    {questions.length > 0 ? ( 
                      <>
                        <div className="flex justify-between items-center mb-4 text-sm sm:text-lg">
                          <p>Score: <span className="font-bold text-green-400">{score}</span></p>
                          <p>Wrong: <span className="font-bold text-red-400">{wrongAnswers}/3</span></p>
                        </div>

                        <div className="bg-gray-700 rounded-xl p-4 sm:p-6 mb-6 shadow-inner border border-gray-600 animate-slide-in-right">
                          <p className="text-base sm:text-xl font-medium mb-4 text-white">
                            Question {currentQuestionIndex + 1} of {questions.length}:
                          </p>
                          <p className="text-xl sm:text-2xl font-bold text-yellow-300 mb-6">
                            {questions[currentQuestionIndex]?.question}
                          </p>
                        </div>

                        {/* Options for multiple choice */}
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4 mb-6">
                          {questions[currentQuestionIndex]?.options.map((option, index) => (
                            <button
                              key={index}
                              onClick={() => setSelectedOption(option)}
                              className={`py-3 px-4 rounded-xl transition duration-200 ease-in-out text-sm sm:text-lg text-white font-medium ${
                                selectedOption === option
                                  ? 'bg-blue-700 ring-2 ring-blue-400 transform scale-105'
                                  : 'bg-gray-600 hover:bg-gray-700'
                              } shadow-md`}
                            >
                              {option}
                            </button>
                          ))}
                        </div>

                        <button
                          onClick={checkAnswer}
                          disabled={selectedOption === null}
                          className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 sm:py-4 rounded-xl transition duration-300 ease-in-out transform hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed text-base sm:text-lg"
                        >
                          Submit Answer
                        </button>

                        {feedbackMessage && (
                          <div className={`mt-4 sm:mt-6 p-3 sm:p-4 rounded-xl text-center shadow-md animate-fade-in-up ${
                               feedbackMessage.includes('Correct') ? 'bg-green-600' : 'bg-red-600'
                             }`}>
                            <p className="text-white font-semibold text-sm sm:text-lg">{feedbackMessage}</p>
                            {showAnswer && (
                              <p className="text-white text-xs sm:text-md mt-2">
                                <span className="font-bold">Correct Answer:</span> {questions[currentQuestionIndex]?.correctAnswer}
                              </p>
                            )}
                          </div>
                        )}
                      </>
                    ) : (
                      <p className="text-base sm:text-xl text-gray-400 text-center py-10">Loading questions or no questions available for this selection. Please select a category and difficulty.</p>
                    )}
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>